<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Possible Studio Edit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        input[type="date"]::-webkit-datetime-edit-day-field:not([value=""]),
        input[type="date"]::-webkit-datetime-edit-month-field:not([value=""]),
        input[type="date"]::-webkit-datetime-edit-year-field:not([value=""]) {
            color: #1F2937;
        }
        input[type="date"]:invalid::-webkit-datetime-edit-day-field,
        input[type="date"]:invalid::-webkit-datetime-edit-month-field,
        input[type="date"]:invalid::-webkit-datetime-edit-year-field {
            color: #6B7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.25.6/babel.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
        
        window.firebaseDependencies = {
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut,
            getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, serverTimestamp, deleteDoc
        };

        const __app_id = 'possible-edit';
        const __firebase_config = JSON.stringify({
            // Your Firebase config details here
            apiKey: "AIzaSyBgK_QIzwtpTv23I54CcLKThWuzPiG5F-Q",
            authDomain: "possible-edit.firebaseapp.com",
            projectId: "possible-edit",
            storageBucket: "possible-edit.firebasestorage.app",
            messagingSenderId: "1035721158713",
            appId: "1:1035721158713:web:26ec99e2bc141c39f51de8",
            measurementId: "G-EM1KWNFJBC"
        });
        const __initial_auth_token = null;

        window.globalAppConfig = {
            __app_id, __firebase_config, __initial_auth_token
        };
    </script>
    <script type="text/babel">
        const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } = window.firebaseDependencies;
        const { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, serverTimestamp, deleteDoc } = window.firebaseDependencies;
        const { __app_id, __firebase_config, __initial_auth_token } = window.globalAppConfig;

        // --- Utility Functions ---

        const getFilteredProjects = (projects, currentTab) => {
            const now = Date.now();
            const twentyFourHours = 24 * 60 * 60 * 1000;
            
            let filteredProjects = projects;
            
            if (currentTab === 'active') {
                filteredProjects = projects.filter(project => {
                    if (project.status === 'on process' || project.status === 'on hold' || project.status === 'up next') return true;
                    if (project.status === 'completed' && project.completedAt) {
                        return (now - project.completedAt.getTime()) < twentyFourHours;
                    }
                    if (project.status === 'dropped' && project.droppedAt) {
                        return (now - project.droppedAt.getTime()) < twentyFourHours;
                    }
                    return false;
                });
            } else if (currentTab === 'completed') {
                filteredProjects = projects.filter(project => {
                    if (project.status === 'completed' && project.completedAt) {
                        return (now - project.completedAt.getTime()) >= twentyFourHours;
                    }
                    if (project.status === 'dropped' && project.droppedAt) {
                        return (now - project.droppedAt.getTime()) >= twentyFourHours;
                    }
                    return false;
                });
            }

            return filteredProjects.sort((a, b) => {
                if (a.isUrgent && !b.isUrgent) return -1;
                if (!a.isUrgent && b.isUrgent) return 1;

                const statusOrder = { 'on process': 1, 'up next': 2, 'on hold': 3, 'completed': 4, 'dropped': 5 };
                const statusA = statusOrder[a.status] || 99;
                const statusB = statusOrder[b.status] || 99;
                if (statusA !== statusB) return statusA - statusB;
                
                if (a.status === 'on process' || a.status === 'on hold' || a.status === 'up next') {
                    if (!a.shootDay && !b.shootDay) return 0;
                    if (!a.shootDay) return 1;
                    if (!b.shootDay) return -1;
                    return a.shootDay.getTime() - b.shootDay.getTime();
                }
                if (a.status === 'completed' || a.status === 'dropped') {
                    const timeA = a.status === 'completed' ? a.completedAt?.getTime() : a.droppedAt?.getTime();
                    const timeB = b.status === 'completed' ? b.completedAt?.getTime() : b.droppedAt?.getTime();
                    if (!timeA && !timeB) return 0;
                    if (!timeA) return 1;
                    if (!timeB) return -1;
                    return timeB - timeA;
                }
                return 0;
            });
        };

        const calculateDaysAfterShoot = (shootDay) => {
            if (!shootDay) return 'N/A';
            const today = new Date();
            const shootDate = new Date(shootDay.getFullYear(), today.getMonth(), today.getDate());
            const currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const diffTime = Math.abs(currentDate.getTime() - shootDate.getTime());
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        };

        const calculateRemainingDays = (deadline) => {
            if (!deadline) return 'No Deadline';
            const today = new Date();
            const deadlineDate = new Date(deadline.getFullYear(), deadline.getMonth(), deadline.getDate());
            const currentDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const diffTime = deadlineDate.getTime() - currentDate.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays > 0) return `${diffDays} days`;
            if (diffDays === 0) return 'Due Today';
            return `${Math.abs(diffDays)} days overdue`;
        };

        const formatDateToDDMMYYYY = (date) => {
            if (!date) return 'N/A';
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}/${month}/${year}`;
        };

        const formatDateTime = (date) => {
            if (!date) return 'N/A';
            const d = new Date(date);
            return d.toLocaleString();
        };

        // --- Error Boundary Component ---
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, errorMessage: '' };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, errorMessage: error.message || 'Something went wrong.' };
            }

            componentDidCatch(error, errorInfo) {
                console.error("ErrorBoundary caught error:", error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="container mx-auto p-4 text-center">
                            <p className="text-red-500 text-sm font-medium">
                                {this.state.errorMessage} Please refresh the page or try again later.
                            </p>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // --- Main App Component ---
        const App = () => {
            const [userId, setUserId] = React.useState(null);
            const [isAdmin, setIsAdmin] = React.useState(false);
            const [isUrgentAdmin, setIsUrgentAdmin] = React.useState(false);
            const [isEditor, setIsEditor] = React.useState(false);
            const [projects, setProjects] = React.useState([]);
            const [clients, setClients] = React.useState([]);
            const [isLoading, setIsLoading] = React.useState(true);
            const [message, setMessage] = React.useState({ text: '', type: '' });
            const [showAddProjectModal, setShowAddProjectModal] = React.useState(false);
            const [showManageClientsModal, setShowManageClientsModal] = React.useState(false);
            const [showLoginModal, setShowLoginModal] = React.useState(false);
            const [loginType, setLoginType] = React.useState(null);
            const [currentTab, setCurrentTab] = React.useState('active');
            const [urgentProjectId, setUrgentProjectId] = React.useState(null);
            const [showAllVideos, setShowAllVideos] = React.useState(false);

            const showMessage = React.useCallback((text, type) => {
                setMessage({ text, type });
                const timer = setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                return () => clearTimeout(timer);
            }, []);

            const totalActiveVideos = React.useMemo(() => {
                return projects.filter(project => project.status !== 'completed' && project.status !== 'dropped').length;
            }, [projects]);
            
            const firebaseConfig = JSON.parse(__firebase_config);
            const app = React.useMemo(() => initializeApp(firebaseConfig), [firebaseConfig]);
            const auth = React.useMemo(() => getAuth(app), [app]);
            const db = React.useMemo(() => getFirestore(app), [app]);

            React.useEffect(() => {
                const unsubscribeAuth = onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        setUserId(user.uid);
                    } else {
                        try {
                            if (__initial_auth_token) {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            showMessage("Error authenticating user. Please try again.", "error");
                        }
                    }
                }, (error) => {
                    showMessage("Error monitoring authentication state.", "error");
                });
                return () => unsubscribeAuth();
            }, [auth, showMessage]);

            React.useEffect(() => {
                if (!db || !userId) {
                    setProjects([]);
                    setClients([]);
                    setIsLoading(true);
                    return;
                }
                
                const projectsCollectionRef = collection(db, `artifacts/${__app_id}/public/data/projects`);
                const unsubscribeProjects = onSnapshot(projectsCollectionRef, (snapshot) => {
                    try {
                        const fetchedProjects = snapshot.docs.map(doc => {
                            const data = doc.data();
                            return {
                                id: doc.id,
                                ...data,
                                createdAt: data.createdAt?.toDate?.() || new Date(),
                                shootDay: data.shootDay?.toDate?.(),
                                completedAt: data.completedAt?.toDate?.(),
                                droppedAt: data.droppedAt?.toDate?.(),
                                approvedAt: data.approvedAt?.toDate?.(),
                                deadline: data.deadline?.toDate?.(),
                            };
                        });
                        setProjects(fetchedProjects);
                        const urgentProject = fetchedProjects.find(p => p.isUrgent);
                        setUrgentProjectId(urgentProject ? urgentProject.id : null);
                        setIsLoading(false);
                    } catch (err) {
                        showMessage("Error loading projects. Please refresh.", "error");
                        setIsLoading(false);
                    }
                }, (error) => {
                    if (error.code === 'permission-denied') {
                        showMessage("Firestore permission denied. Please check your security rules.", "error");
                    } else {
                        showMessage("Error fetching projects. Please refresh.", "error");
                    }
                    setIsLoading(false);
                });

                const clientsCollectionRef = collection(db, `artifacts/${__app_id}/public/data/clients`);
                const unsubscribeClients = onSnapshot(clientsCollectionRef, (snapshot) => {
                    try {
                        setClients(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    } catch (err) {
                        showMessage("Error loading clients. Please refresh.", "error");
                    }
                }, (error) => {
                    if (error.code === 'permission-denied') {
                        showMessage("Firestore permission denied for clients. Please check your security rules.", "error");
                    } else {
                        showMessage("Error fetching clients. Please refresh.", "error");
                    }
                });

                return () => {
                    unsubscribeProjects();
                    unsubscribeClients();
                    setIsLoading(true);
                };
            }, [db, userId, showMessage]);

            const handleLogin = async (password) => {
                // Unified login logic
                if (password === '1122') {
                    setIsAdmin(true); setIsEditor(false); setIsUrgentAdmin(false); 
                    showMessage("Admin logged in successfully!", "success");
                    setShowLoginModal(false);
                } else if (password === '9361') {
                    setIsUrgentAdmin(true); setIsAdmin(false); setIsEditor(false); 
                    showMessage("Urgent Admin logged in successfully!", "success");
                    setShowLoginModal(false);
                } else if (password === '9042') {
                    setIsEditor(true); setIsAdmin(false); setIsUrgentAdmin(false);
                    showMessage("Editor logged in successfully!", "success");
                    setShowLoginModal(false);
                } else {
                    showMessage("Incorrect password.", "error");
                }
            };
            

            const handleLogout = async () => {
                try {
                    if (auth) await signOut(auth);
                    setIsAdmin(false); setIsUrgentAdmin(false); setIsEditor(false); setUserId(null);
                    if (__initial_auth_token) await signInWithCustomToken(auth, __initial_auth_token);
                    else await signInAnonymously(auth);
                    showMessage("Logged out successfully.", "info");
                } catch (error) {
                    showMessage("Error logging out. Please try again.", "error");
                }
            };

            const handleAddClient = async (clientName) => {
                try {
                    await addDoc(collection(db, `artifacts/${__app_id}/public/data/clients`), {
                        clientName: clientName, createdAt: serverTimestamp(),
                    });
                    showMessage("Client added successfully!", "success");
                    return { success: true, clientName: clientName };
                } catch (e) {
                    showMessage("Error adding client. Please try again.", "error");
                    return { success: false };
                }
            };
            
            const handleDeleteClient = async (clientId) => {
                if (!isAdmin) {
                    showMessage("Permission denied.", "error");
                    return;
                }
                try {
                    const clientRef = doc(db, `artifacts/${__app_id}/public/data/clients`, clientId);
                    await deleteDoc(clientRef);
                    showMessage("Client deleted successfully!", "success");
                } catch (e) {
                    showMessage("Error deleting client.", "error");
                }
            };
            
            const handleAddProject = async (newProject) => {
                try {
                    await addDoc(collection(db, `artifacts/${__app_id}/public/data/projects`), {
                        ...newProject,
                        createdAt: serverTimestamp(),
                        status: 'on hold',
                        deadline: newProject.deadline ? new Date(newProject.deadline) : null,
                        shootDay: newProject.shootDay ? new Date(newProject.shootDay) : null,
                        isUrgent: false,
                    });
                    showMessage("Project added successfully!", "success");
                    setShowAddProjectModal(false);
                } catch (e) {
                    showMessage("Error adding project. Please try again.", "error");
                }
            };
            
            const handleUpdateProjectStatus = async (projectId, newStatus) => {
                try {
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    const currentProject = projects.find(p => p.id === projectId);
                    if (!currentProject) { showMessage("Project not found.", "error"); return; }
                    if (isAdmin) {
                        const updateData = { status: newStatus, requestedStatus: null, requestedBy: null, approvedAt: serverTimestamp() };
                        if (newStatus === 'completed') {
                            updateData.completedAt = serverTimestamp(); updateData.droppedAt = null; updateData.isUrgent = false;
                            if (currentProject.id === urgentProjectId) setUrgentProjectId(null);
                        } else if (newStatus === 'dropped') {
                            updateData.droppedAt = serverTimestamp(); updateData.completedAt = null;
                        } else {
                            updateData.completedAt = null; updateData.droppedAt = null;
                        }
                        await updateDoc(projectRef, updateData);
                        showMessage("Project status updated!", "success");
                    } else if (isEditor) {
                        if (['completed', 'dropped'].includes(newStatus)) {
                            await updateDoc(projectRef, { requestedStatus: newStatus, requestedBy: userId });
                            showMessage(`Status change to '${newStatus}' requested.`, "info");
                        } else {
                            await updateDoc(projectRef, { status: newStatus, requestedStatus: null, requestedBy: null, approvedAt: null, completedAt: null, droppedAt: null });
                            showMessage("Project status updated!", "success");
                        }
                    } else {
                        showMessage("Permission denied.", "error");
                    }
                } catch (e) {
                    showMessage("Error updating project status.", "error");
                }
            };
            
            const handleApproveStatusChange = async (projectId) => {
                if (!isAdmin) { showMessage("Permission denied.", "error"); return; }
                try {
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    const projectToApprove = projects.find(p => p.id === projectId);
                    if (!projectToApprove || !projectToApprove.requestedStatus) { showMessage("No pending status change.", "error"); return; }
                    const newStatus = projectToApprove.requestedStatus;
                    const updateData = { status: newStatus, requestedStatus: null, requestedBy: null, approvedAt: serverTimestamp() };
                    if (newStatus === 'completed') {
                        updateData.completedAt = serverTimestamp(); updateData.droppedAt = null; updateData.isUrgent = false;
                        if (projectToApprove.id === urgentProjectId) setUrgentProjectId(null);
                    } else if (newStatus === 'dropped') {
                        updateData.droppedAt = serverTimestamp(); updateData.completedAt = null;
                    }
                    await updateDoc(projectRef, updateData);
                    showMessage(`Status change to '${newStatus}' approved!`, "success");
                } catch (e) {
                    showMessage("Error approving status change.", "error");
                }
            };
            
            const handleRejectStatusChange = async (projectId) => {
                if (!isAdmin) { showMessage("Permission denied.", "error"); return; }
                try {
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    await updateDoc(projectRef, { requestedStatus: null, requestedBy: null });
                    showMessage("Status change request rejected.", "info");
                } catch (e) {
                    showMessage("Error rejecting status change.", "error");
                }
            };
            
            const handleEditProject = async (projectId, updatedFields) => {
                try {
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    await updateDoc(projectRef, updatedFields);
                    showMessage("Project updated successfully!", "success");
                } catch (e) {
                    showMessage("Error updating project.", "error");
                }
            };
            
            const handleDeleteProject = async (projectId) => {
                if (!isAdmin) { showMessage("Permission denied.", "error"); return; }
                try {
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    await deleteDoc(projectRef);
                    showMessage("Project deleted successfully!", "success");
                } catch (e) {
                    showMessage("Error deleting project.", "error");
                }
            };
            
            const handleMarkUrgent = async (projectId) => {
                if (!isUrgentAdmin) { showMessage("Permission denied.", "error"); return; }
                try {
                    if (urgentProjectId && urgentProjectId !== projectId) {
                        const previousUrgentRef = doc(db, `artifacts/${__app_id}/public/data/projects`, urgentProjectId);
                        await updateDoc(previousUrgentRef, { isUrgent: false });
                    }
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    await updateDoc(projectRef, { isUrgent: true });
                    setUrgentProjectId(projectId);
                    showMessage("Project marked as urgent!", "success");
                } catch (e) {
                    showMessage("Error marking project urgent.", "error");
                }
            };
            
            const handleClearUrgent = async (projectId) => {
                if (!isUrgentAdmin) { showMessage("Permission denied.", "error"); return; }
                try {
                    const projectRef = doc(db, `artifacts/${__app_id}/public/data/projects`, projectId);
                    await updateDoc(projectRef, { isUrgent: false });
                    setUrgentProjectId(null);
                    showMessage("Urgent status cleared!", "success");
                } catch (e) {
                    showMessage("Error clearing urgent status.", "error");
                }
            };
            
            return (
                <ErrorBoundary>
                    <div className="min-h-screen bg-gray-50 font-sans text-gray-900 flex flex-col">
                        {message.text && (
                            <div className={`fixed top-3 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-md z-50 bg-opacity-90 text-sm font-medium
                                ${message.type === 'success' ? 'bg-green-500 text-white' : ''}
                                ${message.type === 'error' ? 'bg-red-500 text-white' : ''}
                                ${message.type === 'info' ? 'bg-blue-500 text-white' : ''}`}>
                                {message.text}
                            </div>
                        )}
                        <header className="bg-white border-b border-gray-200 p-3">
                            <div className="container mx-auto flex items-center justify-between gap-3">
                                <div className="flex items-center space-x-4">
                                    <h1 className="text-xl sm:text-2xl font-bold">Possible Studio Edit</h1>
                                    <div className="flex items-center gap-2">
                                        <button
                                            className={`px-4 py-1.5 rounded-md text-sm font-medium transition duration-200
                                                ${currentTab === 'active' ? 'bg-yellow-500 text-gray-900' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                            onClick={() => setCurrentTab('active')}
                                        >
                                            Active Projects
                                        </button>
                                        <button
                                            className={`px-4 py-1.5 rounded-md text-sm font-medium transition duration-200
                                                ${currentTab === 'completed' ? 'bg-yellow-500 text-gray-900' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                            onClick={() => setCurrentTab('completed')}
                                        >
                                            Completed
                                        </button>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    {(isAdmin || isUrgentAdmin || isEditor) ? (
                                        <button onClick={handleLogout}
                                            className="bg-red-500 hover:bg-red-600 text-white text-sm font-medium py-1.5 px-4 rounded-md transition duration-200">
                                            Logout
                                        </button>
                                    ) : (
                                        <button onClick={() => setShowLoginModal(true)}
                                            className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                            Login
                                        </button>
                                    )}
                                </div>
                            </div>
                        </header>
                        <main className="container mx-auto p-4 flex-grow max-w-6xl">
                            <div className="mb-6">
                                <MotherCard
                                    totalActiveVideos={totalActiveVideos}
                                    showAllVideos={showAllVideos}
                                    setShowAllVideos={setShowAllVideos}
                                    projects={projects}
                                    formatDateToDDMMYYYY={formatDateToDDMMYYYY}
                                    formatDateTime={formatDateTime}
                                    isAdmin={isAdmin}
                                    isEditor={isEditor}
                                />
                            </div>
                            <div className="flex flex-wrap items-center justify-center gap-3 mb-6">
                                {isAdmin && (
                                    <>
                                        <button
                                            onClick={() => setShowAddProjectModal(true)}
                                            className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-medium py-2 px-6 rounded-md transition duration-200"
                                        >
                                            + Add Project
                                        </button>
                                        <button
                                            onClick={() => setShowManageClientsModal(true)}
                                            className="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-md transition duration-200"
                                        >
                                            Manage Clients
                                        </button>
                                    </>
                                )}
                            </div>
                            <div className="flex flex-col gap-4">
                                {isLoading ? (
                                    <p className="col-span-full text-center text-gray-600 text-sm py-8">
                                        Loading projects...
                                    </p>
                                ) : getFilteredProjects(projects, currentTab).length === 0 ? (
                                    <p className="col-span-full text-center text-gray-600 text-sm py-8">
                                        {currentTab === 'active' ? 'No active projects found.' : 'No completed or dropped projects.'}
                                    </p>
                                ) : (
                                    Object.entries(getFilteredProjects(projects, currentTab).reduce((acc, project) => {
                                        const clientName = project.clientName || 'Unassigned';
                                        if (!acc[clientName]) {
                                            acc[clientName] = [];
                                        }
                                        acc[clientName].push(project);
                                        return acc;
                                    }, {})).map(([clientName, clientProjects]) => (
                                        <ClientProjectGroup
                                            key={clientName}
                                            clientName={clientName}
                                            projects={clientProjects}
                                            calculateDaysAfterShoot={calculateDaysAfterShoot}
                                            calculateRemainingDays={calculateRemainingDays}
                                            formatDateToDDMMYYYY={formatDateToDDMMYYYY}
                                            formatDateTime={formatDateTime}
                                            onUpdateStatus={handleUpdateProjectStatus}
                                            onEditProject={handleEditProject}
                                            onApproveStatusChange={handleApproveStatusChange}
                                            onRejectStatusChange={handleRejectStatusChange}
                                            onDeleteProject={handleDeleteProject}
                                            onMarkUrgent={handleMarkUrgent}
                                            onClearUrgent={handleClearUrgent}
                                            isAdmin={isAdmin}
                                            isUrgentAdmin={isUrgentAdmin}
                                            isEditor={isEditor}
                                            urgentProjectId={urgentProjectId}
                                            currentUserId={userId}
                                            clients={clients}
                                        />
                                    ))
                                )}
                            </div>
                        </main>
                        <footer className="bg-white border-t border-gray-200 text-gray-600 text-center p-3 text-sm">
                            <p>© {new Date().getFullYear()} Possible Studio Edit</p>
                        </footer>
                        {showAddProjectModal && (
                            <AddProjectModal
                                onClose={() => setShowAddProjectModal(false)}
                                onAddProject={handleAddProject}
                                onAddClient={handleAddClient}
                                isAdmin={isAdmin}
                                clients={clients}
                            />
                        )}
                        {showManageClientsModal && isAdmin && (
                            <ManageClientsModal
                                onClose={() => setShowManageClientsModal(false)}
                                clients={clients}
                                onAddClient={handleAddClient}
                                onDeleteClient={handleDeleteClient}
                            />
                        )}
                         {showLoginModal && (
                            <LoginModal
                                onClose={() => setShowLoginModal(false)}
                                onLogin={handleLogin}
                                type={loginType}
                            />
                        )}
                    </div>
                </ErrorBoundary>
            );
        };
        
        const ClientProjectGroup = ({ clientName, projects, ...props }) => {
            const [isCollapsed, setIsCollapsed] = React.useState(true);
            const onProcessCount = projects.filter(p => p.status === 'on process').length;
            const upNextCount = projects.filter(p => p.status === 'up next').length;
            const urgentCount = projects.filter(p => p.isUrgent).length;

            return (
                <div className="bg-white rounded-md shadow-lg border border-gray-200 overflow-hidden">
                    <div className="flex items-center justify-between p-4 bg-gray-100 cursor-pointer" onClick={() => setIsCollapsed(!isCollapsed)}>
                        <div className="flex items-center gap-2">
                            <h2 className="text-lg font-bold text-gray-900">{clientName}</h2>
                            <div className="flex items-center space-x-2">
                                {onProcessCount > 0 && (
                                    <span className="px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-500 text-gray-900">
                                        {onProcessCount} On Process
                                    </span>
                                )}
                                {upNextCount > 0 && (
                                    <span className="px-2 py-0.5 rounded-full text-xs font-medium bg-indigo-500 text-white">
                                        {upNextCount} Up Next
                                    </span>
                                )}
                                {urgentCount > 0 && (
                                    <span className="px-2 py-0.5 rounded-full text-xs font-medium bg-red-700 text-white animate-pulse">
                                        {urgentCount} Urgent
                                    </span>
                                )}
                                <span className="text-sm font-medium text-gray-600">
                                    / {projects.length} total
                                </span>
                            </div>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" className={`h-5 w-5 text-gray-500 transition-transform duration-200 ${isCollapsed ? '' : 'transform rotate-180'}`} viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" />
                        </svg>
                    </div>
                    {!isCollapsed && (
                        <div className="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {projects.map(project => (
                                <ProjectCard key={project.id} project={project} {...props} />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const MotherCard = ({ totalActiveVideos, showAllVideos, setShowAllVideos, projects, formatDateToDDMMYYYY, formatDateTime }) => {
             const onProcessCount = projects.filter(project => project.status === 'on process').length;
            const upNextCount = projects.filter(project => project.status === 'up next').length;

            return (
                <div className="bg-white rounded-md shadow-lg border border-gray-200 p-5 cursor-pointer hover:bg-gray-100 transition duration-200" onClick={() => setShowAllVideos(!showAllVideos)}>
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold text-gray-900">Pending Videos</h2>
                        <span className="text-3xl font-extrabold text-yellow-500">{totalActiveVideos}</span>
                    </div>
                    <div className="flex justify-between items-center mt-3 text-sm text-gray-600">
                        <p><span className="font-medium text-gray-900">On Process:</span> {onProcessCount}</p>
                        <p><span className="font-medium text-gray-900">Up Next:</span> {upNextCount}</p>
                    </div>
                    <p className="text-sm text-gray-600 mt-1">Click to {showAllVideos ? 'hide' : 'view'} all videos.</p>
                    {showAllVideos && (
                        <div className="mt-4 border-t border-gray-200 pt-4">
                            <ProjectsTable
                                projects={projects}
                                formatDateToDDMMYYYY={formatDateToDDMMYYYY}
                                formatDateTime={formatDateTime}
                            />
                        </div>
                    )}
                </div>
            );
        };

        const ProjectsTable = ({ projects, formatDateToDDMMYYYY, formatDateTime }) => {
            const sortedProjects = [...projects].sort((a, b) => {
                const statusOrder = { 'on process': 1, 'up next': 2, 'on hold': 3, 'completed': 4, 'dropped': 5 };
                return (statusOrder[a.status] || 99) - (statusOrder[b.status] || 99);
            });

            return (
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project Name</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Shoot Date</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deadline</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Note</th>
                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                            {sortedProjects.map(project => (
                                <tr key={project.id} className={`${project.isUrgent ? 'bg-red-50' : 'hover:bg-gray-50'} transition duration-150`}>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{project.projectName}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{project.clientName || 'N/A'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{formatDateToDDMMYYYY(project.shootDay)}</td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{formatDateToDDMMYYYY(project.deadline)}</td>
                                    <td className="px-6 py-4 text-sm text-gray-600 max-w-[200px] truncate">{project.note || 'None'}</td>
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        <span className={`px-2 py-0.5 rounded-full text-xs font-medium text-white
                                            ${project.status === 'completed' ? 'bg-green-500' : ''}
                                            ${project.status === 'dropped' ? 'bg-red-500' : ''}
                                            ${project.status === 'on hold' ? 'bg-orange-500' : ''}
                                            ${project.status === 'up next' ? 'bg-indigo-500' : ''}
                                            ${project.status === 'on process' ? 'bg-yellow-500' : ''}
                                        `}>
                                            {project.status}
                                        </span>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        };

        const ProjectCard = ({ project, calculateDaysAfterShoot, calculateRemainingDays, formatDateToDDMMYYYY, formatDateTime, onUpdateStatus, onEditProject, onApproveStatusChange, onRejectStatusChange, onDeleteProject, onMarkUrgent, onClearUrgent, isAdmin, isUrgentAdmin, isEditor, urgentProjectId, currentUserId, clients }) => {
            const [isEditing, setIsEditing] = React.useState(false);
            const [editedProjectName, setEditedProjectName] = React.useState(project.projectName);
            const [editedNote, setEditedNote] = React.useState(project.note);
            const [editedStatus, setEditedStatus] = React.useState(project.status);
            const [editedClientName, setEditedClientName] = React.useState(project.clientName || '');

            React.useEffect(() => {
                setEditedProjectName(project.projectName);
                setEditedNote(project.note);
                setEditedStatus(project.status);
                setEditedClientName(project.clientName || '');
            }, [project]);

            const getStatusDisplay = (status) => {
                switch (status) {
                    case 'completed': return { text: 'Completed', color: 'bg-green-500' };
                    case 'dropped': return { text: 'Dropped', color: 'bg-red-500' };
                    case 'on hold': return { text: 'On Hold', color: 'bg-orange-500' };
                    case 'up next': return { text: 'Up Next', color: 'bg-indigo-500' };
                    case 'on process':
                    default: return { text: 'On Process', color: 'bg-yellow-500' };
                }
            };

            const currentStatusDisplay = getStatusDisplay(project.status);
            const requestedStatusDisplay = project.requestedStatus ? getStatusDisplay(project.requestedStatus) : null;
            
            const cardBackgroundColor = project.isUrgent ? 'bg-red-100' : ((project.status === 'completed' || project.status === 'dropped') ? 'bg-yellow-50' : 'bg-white');

            const handleSaveEdit = () => {
                const updatedFields = { note: editedNote, clientName: editedClientName };
                if (isAdmin) updatedFields.projectName = editedProjectName;
                onEditProject(project.id, updatedFields);
                if (editedStatus !== project.status) onUpdateStatus(project.id, editedStatus);
                setIsEditing(false);
            };

            const handleCancelEdit = () => {
                setEditedProjectName(project.projectName);
                setEditedNote(project.note);
                setEditedStatus(project.status);
                setEditedClientName(project.clientName || '');
                setIsEditing(false);
            };

            return (
                <div className={`${cardBackgroundColor} rounded-md border border-gray-200 p-4 flex flex-col gap-3`}>
                    {isEditing ? (
                        <>
                            <div>
                                <label htmlFor={`projectName-${project.id}`} className="block text-xs font-medium text-gray-700 mb-1">
                                    Project Name
                                </label>
                                {isAdmin ? (
                                    <input
                                        type="text"
                                        id={`projectName-${project.id}`}
                                        className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                        value={editedProjectName}
                                        onChange={(e) => setEditedProjectName(e.target.value)}
                                    />
                                ) : (
                                    <p className="text-sm font-medium text-gray-800">{project.projectName}</p>
                                )}
                            </div>
                            <div>
                                <label htmlFor={`clientName-${project.id}`} className="block text-xs font-medium text-gray-700 mb-1">
                                    Client Name
                                </label>
                                {clients.length > 0 ? (
                                    <select
                                        id={`clientName-${project.id}`}
                                        className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                        value={editedClientName}
                                        onChange={(e) => setEditedClientName(e.target.value)}
                                    >
                                        <option value="" disabled>Select an existing client</option>
                                        {clients.map(client => (
                                            <option key={client.id} value={client.clientName}>{client.clientName}</option>
                                        ))}
                                    </select>
                                ) : (
                                    <input
                                        type="text"
                                        id={`clientName-${project.id}`}
                                        className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                        value={editedClientName}
                                        onChange={(e) => setEditedClientName(e.target.value)}
                                        placeholder="No clients found. Enter new client name."
                                    />
                                )}
                            </div>
                            <div>
                                <label htmlFor={`note-${project.id}`} className="block text-xs font-medium text-gray-700 mb-1">
                                    Note
                                </label>
                                <textarea
                                    id="note"
                                    rows="2"
                                    className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500 resize-none"
                                    value={editedNote}
                                    onChange={(e) => setEditedNote(e.target.value)}
                                ></textarea>
                            </div>
                            <div>
                                <label htmlFor={`status-${project.id}`} className="block text-xs font-medium text-gray-700 mb-1">
                                    Status
                                </label>
                                <select
                                    id={`status-${project.id}`}
                                    className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                    value={editedStatus}
                                    onChange={(e) => setEditedStatus(e.target.value)}
                                >
                                    <option value="on process">On Process</option>
                                    <option value="on hold">On Hold</option>
                                    <option value="up next">Up Next</option>
                                    <option value="dropped">Dropped</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                        </>
                    ) : (
                        <>
                            <h3 className="text-base font-semibold text-gray-900">{project.projectName}</h3>
                            <div className="text-xs text-gray-600 grid grid-cols-2 gap-x-2 gap-y-1">
                                <p><span className="font-medium">Client:</span> {project.clientName || 'N/A'}</p>
                                <p><span className="font-medium">Shoot Day:</span> {project.shootDay ? formatDateToDDMMYYYY(project.shootDay) : 'N/A'}</p>
                                <p><span className="font-medium">Days After:</span> {calculateDaysAfterShoot(project.shootDay)}</p>
                                <p><span className="font-medium">Deadline:</span> {project.deadline ? `${formatDateToDDMMYYYY(project.deadline)} - ${calculateRemainingDays(project.deadline)}` : 'No Deadline'}</p>
                                {project.completedAt && (
                                    <p><span className="font-medium">Completed:</span> {formatDateTime(project.completedAt)}</p>
                                )}
                                {project.droppedAt && (
                                    <p><span className="font-medium">Dropped:</span> {formatDateTime(project.droppedAt)}</p>
                                )}
                            </div>
                            <div className="flex flex-wrap gap-2">
                                <span className={`px-2 py-0.5 rounded text-xs font-medium text-white ${currentStatusDisplay.color}`}>
                                    {currentStatusDisplay.text}
                                </span>
                                {project.requestedStatus && (
                                    <span className={`px-2 py-0.5 rounded text-xs font-medium text-white bg-purple-500`}>
                                        Pending: {requestedStatusDisplay.text}
                                    </span>
                                )}
                                {project.isUrgent && (
                                    <span className="px-2 py-0.5 rounded text-xs font-medium text-white bg-red-700 animate-pulse">
                                        URGENT!
                                    </span>
                                )}
                            </div>
                            <p className="text-xs text-gray-600 break-words">
                                <span className="font-medium">Note:</span> {project.note || 'None'}
                            </p>
                        </>
                    )}
                    <div className="flex justify-end gap-2 mt-auto flex-wrap">
                        {isEditing ? (
                            <>
                                <button onClick={handleCancelEdit}
                                    className="bg-gray-300 hover:bg-gray-400 text-gray-800 text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                    Cancel
                                </button>
                                <button onClick={handleSaveEdit}
                                    className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                    Save
                                </button>
                            </>
                        ) : (
                            <>
                                {isAdmin && project.requestedStatus && (
                                    <>
                                        <button onClick={() => onApproveStatusChange(project.id)}
                                            className="bg-green-500 hover:bg-green-600 text-white text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                            Approve
                                        </button>
                                        <button onClick={() => onRejectStatusChange(project.id)}
                                            className="bg-red-500 hover:bg-red-600 text-white text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                            Reject
                                        </button>
                                    </>
                                )}
                                {(isAdmin || isEditor) && (
                                    <button onClick={() => setIsEditing(true)}
                                        className="bg-gray-500 hover:bg-gray-600 text-white text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Edit
                                    </button>
                                )}
                                {isAdmin && (
                                    <button onClick={() => onDeleteProject(project.id)}
                                        className="bg-red-500 hover:bg-red-600 text-white text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Delete
                                    </button>
                                )}
                                {isUrgentAdmin && !project.isUrgent && urgentProjectId === null && (
                                    <button onClick={() => onMarkUrgent(project.id)}
                                        className="bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Mark Urgent
                                    </button>
                                )}
                                {isUrgentAdmin && project.isUrgent && (
                                    <button onClick={() => onClearUrgent(project.id)}
                                        className="bg-green-700 hover:bg-green-800 text-white text-xs font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Clear Urgent
                                    </button>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        const AddProjectModal = ({ onClose, onAddProject, onAddClient, isAdmin, clients }) => {
            const [step, setStep] = React.useState(1);
            const [clientType, setClientType] = React.useState('existing');
            const [newClientName, setNewClientName] = React.useState('');
            const [selectedClientName, setSelectedClientName] = React.useState('');
            const [projectName, setProjectName] = React.useState('');
            const [shootDay, setShootDay] = React.useState('');
            const [note, setNote] = React.useState('');
            const [deadline, setDeadline] = React.useState('');
            const [errorMessage, setErrorMessage] = React.useState('');

            const getTodayDate = () => {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const handleClientStepSubmit = async (e) => {
                e.preventDefault();
                setErrorMessage('');
                if (clientType === 'new') {
                    if (!newClientName.trim()) {
                        setErrorMessage('Client name is required.');
                        return;
                    }
                    const result = await onAddClient(newClientName.trim());
                    if (result.success) {
                        setSelectedClientName(result.clientName);
                        setStep(2);
                    }
                } else {
                    if (!selectedClientName) {
                        setErrorMessage('Please select a client.');
                        return;
                    }
                    setStep(2);
                }
            };

            const handleProjectStepSubmit = (e) => {
                e.preventDefault();
                if (!projectName.trim() || !shootDay.trim()) {
                    setErrorMessage('Project Name and Shoot Day are required.');
                    return;
                }
                const newProject = {
                    projectName: projectName.trim(),
                    clientName: selectedClientName,
                    shootDay: new Date(shootDay),
                    note: note.trim(),
                    deadline: deadline ? new Date(deadline) : null,
                };
                onAddProject(newProject);
                setProjectName('');
                setShootDay('');
                setNote('');
                setDeadline('');
                setErrorMessage('');
            };

            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
                    <div className="bg-white rounded-md p-6 w-full max-w-md">
                        <h2 className="text-xl font-semibold text-gray-900 mb-4 text-center">
                            {step === 1 ? 'Select Client' : 'Add New Project'}
                        </h2>
                        {step === 1 && (
                            <form onSubmit={handleClientStepSubmit}>
                                <div className="flex flex-col gap-4 mb-4">
                                    <div className="flex items-center">
                                        <input type="radio" id="existingClient" name="clientType" value="existing"
                                            checked={clientType === 'existing'} onChange={(e) => setClientType(e.target.value)}
                                            className="h-4 w-4 text-yellow-500 focus:ring-yellow-500 border-gray-300"
                                        />
                                        <label htmlFor="existingClient" className="ml-2 text-sm text-gray-700 font-medium">
                                            Existing Client
                                        </label>
                                    </div>
                                    {clientType === 'existing' && (
                                        <select
                                            className="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                            value={selectedClientName} onChange={(e) => setSelectedClientName(e.target.value)}
                                        >
                                            <option value="" disabled>Select a client</option>
                                            {clients.map(client => (
                                                <option key={client.id} value={client.clientName}>{client.clientName}</option>
                                            ))}
                                        </select>
                                    )}
                                    <div className="flex items-center">
                                        <input type="radio" id="newClient" name="clientType" value="new"
                                            checked={clientType === 'new'} onChange={(e) => setClientType(e.target.value)}
                                            className="h-4 w-4 text-yellow-500 focus:ring-yellow-500 border-gray-300"
                                        />
                                        <label htmlFor="newClient" className="ml-2 text-sm text-gray-700 font-medium">
                                            New Client
                                        </label>
                                    </div>
                                    {clientType === 'new' && (
                                        <input type="text" id="newClientName" placeholder="Enter new client name"
                                            className="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                            value={newClientName} onChange={(e) => setNewClientName(e.target.value)}
                                        />
                                    )}
                                </div>
                                {errorMessage && (
                                    <p className="text-red-500 text-xs mb-3 text-center">{errorMessage}</p>
                                )}
                                <div className="flex justify-end gap-2">
                                    <button type="button" onClick={onClose}
                                        className="bg-gray-300 hover:bg-gray-400 text-gray-800 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Cancel
                                    </button>
                                    <button type="submit"
                                        className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Next
                                    </button>
                                </div>
                            </form>
                        )}
                        {step === 2 && (
                            <form onSubmit={handleProjectStepSubmit}>
                                <div className="mb-3">
                                    <p className="block text-xs font-medium text-gray-700 mb-1">
                                        Client: <span className="font-semibold">{selectedClientName}</span>
                                    </p>
                                </div>
                                <div className="mb-3">
                                    <label htmlFor="projectName" className="block text-xs font-medium text-gray-700 mb-1">
                                        Project Name
                                    </label>
                                    <input type="text" id="projectName"
                                        className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                        value={projectName} onChange={(e) => setProjectName(e.target.value)} required
                                    />
                                </div>
                                <div className="mb-3">
                                    <label htmlFor="shootDay" className="block text-xs font-medium text-gray-700 mb-1">
                                        Shoot Day
                                    </label>
                                    <input type="date" id="shootDay"
                                        className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                        value={shootDay} onChange={(e) => setShootDay(e.target.value)} max={getTodayDate()} required
                                    />
                                </div>
                                {isAdmin && (
                                    <div className="mb-3">
                                        <label htmlFor="deadline" className="block text-xs font-medium text-gray-700 mb-1">
                                            Deadline (Optional)
                                        </label>
                                        <input type="date" id="deadline"
                                            className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                            value={deadline} onChange={(e) => setDeadline(e.target.value)}
                                        />
                                    </div>
                                )}
                                <div className="mb-3">
                                    <label htmlFor="note" className="block text-xs font-medium text-gray-700 mb-1">
                                        Note
                                    </label>
                                    <textarea id="note" rows="2"
                                        className="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500 resize-none"
                                        value={note} onChange={(e) => setNote(e.target.value)}
                                    ></textarea>
                                </div>
                                {errorMessage && (
                                    <p className="text-red-500 text-xs mb-3 text-center">{errorMessage}</p>
                                )}
                                <div className="flex justify-end gap-2">
                                    <button type="button" onClick={() => setStep(1)}
                                        className="bg-gray-300 hover:bg-gray-400 text-gray-800 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Back
                                    </button>
                                    <button type="submit"
                                        className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                        Add Project
                                    </button>
                                </div>
                            </form>
                        )}
                    </div>
                </div>
            );
        };
        
        const ManageClientsModal = ({ onClose, clients, onAddClient, onDeleteClient }) => {
            const [newClientName, setNewClientName] = React.useState('');
            const [showDeleteConfirmation, setShowDeleteConfirmation] = React.useState(false);
            const [clientToDelete, setClientToDelete] = React.useState(null);

            const handleAddClientSubmit = async (e) => {
                e.preventDefault();
                if (newClientName.trim()) {
                    await onAddClient(newClientName.trim());
                    setNewClientName('');
                }
            };
            
            const handleConfirmDelete = () => {
                if (clientToDelete) {
                    onDeleteClient(clientToDelete);
                    setShowDeleteConfirmation(false);
                    setClientToDelete(null);
                }
            };

            const handleCancelDelete = () => {
                setShowDeleteConfirmation(false);
                setClientToDelete(null);
            };

            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
                    <div className="bg-white rounded-md p-6 w-full max-w-md">
                        <h2 className="text-xl font-semibold text-gray-900 mb-4 text-center">Manage Clients</h2>
                        <div className="max-h-60 overflow-y-auto mb-4">
                            {clients.length === 0 ? (
                                <p className="text-center text-gray-500 text-sm">No clients found.</p>
                            ) : (
                                <ul className="divide-y divide-gray-200">
                                    {clients.map(client => (
                                        <li key={client.id} className="flex items-center justify-between py-2">
                                            <span className="text-gray-800 font-medium">{client.clientName}</span>
                                            <button
                                                onClick={() => { setClientToDelete(client.id); setShowDeleteConfirmation(true); }}
                                                className="bg-red-500 hover:bg-red-600 text-white text-xs font-medium py-1 px-2 rounded-md transition duration-200"
                                            >
                                                Delete
                                            </button>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>
                        <form onSubmit={handleAddClientSubmit} className="flex gap-2">
                            <input
                                type="text"
                                placeholder="Add new client..."
                                className="flex-1 p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                value={newClientName}
                                onChange={(e) => setNewClientName(e.target.value)}
                            />
                            <button
                                type="submit"
                                className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200"
                            >
                                Add
                            </button>
                        </form>
                        <div className="flex justify-end mt-4">
                            <button
                                onClick={onClose}
                                className="bg-gray-300 hover:bg-gray-400 text-gray-800 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                    {showDeleteConfirmation && (
                        <DeleteConfirmationModal
                            onConfirm={handleConfirmDelete}
                            onCancel={handleCancelDelete}
                        />
                    )}
                </div>
            );
        };

        const DeleteConfirmationModal = ({ onConfirm, onCancel }) => {
            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-md p-6 w-full max-w-sm">
                        <h3 className="text-lg font-semibold text-red-600 mb-2">Confirm Deletion</h3>
                        <p className="text-sm text-gray-700 mb-4">Are you sure you want to delete this client? This action cannot be undone.</p>
                        <div className="flex justify-end gap-2">
                            <button onClick={onCancel}
                                className="bg-gray-300 hover:bg-gray-400 text-gray-800 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                Cancel
                            </button>
                            <button onClick={onConfirm}
                                className="bg-red-500 hover:bg-red-600 text-white text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                Confirm
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginModal = ({ onClose, onLogin }) => {
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');

            const handleLoginAttempt = () => {
                if (password === '1122') {
                    onLogin(password, 'admin');
                } else if (password === '9361') {
                    onLogin(password, 'urgent-admin');
                } else if (password === '9042') {
                    onLogin(password, 'editor');
                } else {
                    setError('Incorrect password.');
                }
            };

            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-md p-6 w-full max-w-sm">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4 text-center">Login</h3>
                        <div className="mb-4">
                            <input
                                type="password"
                                placeholder="Enter password"
                                className="w-full p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-yellow-500"
                                value={password}
                                onChange={(e) => {
                                    setPassword(e.target.value);
                                    setError('');
                                }}
                                onKeyDown={(e) => {
                                    if (e.key === 'Enter') handleLoginAttempt();
                                }}
                            />
                            {error && <p className="text-red-500 text-xs mt-2 text-center">{error}</p>}
                        </div>
                        <div className="flex justify-end gap-2">
                            <button onClick={onClose}
                                className="bg-gray-300 hover:bg-gray-400 text-gray-800 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                Cancel
                            </button>
                            <button onClick={handleLoginAttempt}
                                className="bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm font-medium py-1.5 px-3 rounded-md transition duration-200">
                                Login
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
